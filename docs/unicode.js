function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function checkCharacters(e){return new Promise(t=>{const n=e=>{worker.removeEventListener("message",n),t(e.data)};worker.addEventListener("message",n),worker.postMessage({chars:e})})}function colorTable(e,t){return new Promise(n=>{e.classList.contains("bg-warning-subtle")?n():(t.supported||e.classList.add("bg-warning-subtle"),n())})}function isElementInViewport(e){const{top:t,bottom:n}=e.getBoundingClientRect();return 0<=n&&t<=globalThis.innerHeight}async function checkSupportInViewport(){const t=codeTrs.filter(e=>isElementInViewport(e)),e=Date.now();scrollId=e;for(const s of t){if(e!=scrollId)continue;const n=s.children,o=n[0].textContent,i=Number(`0x${o}`),a=Array(16).fill().map((e,t)=>i+t),r=a.map(e=>String.fromCodePoint(e)),c=await checkCharacters(r);await Promise.all(c.map((e,t)=>colorTable(n[t+1],e)))}}loadConfig();const worker=new Worker("/kanji-dict/unicode-worker.js",{type:"module"});let scrollId;const codeTrs=[...document.querySelectorAll("#table tr")].slice(1);checkSupportInViewport(),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,globalThis.addEventListener("scroll",checkSupportInViewport)