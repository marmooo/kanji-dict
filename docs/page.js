let animator,currPos=1;const kanji=document.getElementById("kanji");let kanjiSvg;loadConfig();function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.dataset.theme="dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),delete document.documentElement.dataset.theme):(localStorage.setItem("darkMode",1),document.documentElement.dataset.theme="dark")}function prev(){animator.stop().finish(),currPos-=1,currPos<1&&(currPos=1);let a=1;while(!0){const b=kanjiSvg.getElementById("kvg:"+kanjiId+"-s"+a);if(b)a<currPos?b.setAttribute("stroke","black"):a==currPos?b.setAttribute("stroke","red"):b.setAttribute("stroke","none");else break;a+=1}}function stop(){animator.stop().finish(),currPos=0;let a=1;while(!0){const b=kanjiSvg.getElementById("kvg:"+kanjiId+"-s"+a);if(b)b.setAttribute("stroke","black");else break;a+=1}document.getElementById("stop").classList.add("d-none"),document.getElementById("play").classList.remove("d-none")}function play(){animator.reset().play();let a=1;while(!0){const b=kanjiSvg.getElementById("kvg:"+kanjiId+"-s"+a);if(b)b.setAttribute("stroke","black");else break;a+=1}document.getElementById("stop").classList.remove("d-none"),document.getElementById("play").classList.add("d-none")}function next(){animator.stop().finish();const b=getKakusu();currPos<b&&(currPos+=1);let a=1;while(!0){const b=kanjiSvg.getElementById("kvg:"+kanjiId+"-s"+a);if(b)a<currPos?b.setAttribute("stroke","black"):a==currPos?b.setAttribute("stroke","red"):b.setAttribute("stroke","none");else break;a+=1}}function getKakusu(){let a=1;while(!0){const b=kanjiSvg.getElementById("kvg:"+kanjiId+"-s"+a);if(b)a+=1;else break}return a-1}function addHitujun(){const b=document.getElementById("hitujun"),a=getKakusu();for(let d=1;d<=a;d++){const c=kanjiSvg.cloneNode(!0);c.setAttribute("width",64),c.setAttribute("height",64),c.removeAttribute("id");for(let b=d+1;b<=a;b++){const f="kvg:"+kanjiId+"-s"+b,e=c.querySelector('[id="'+f+'"]');e.setAttribute("stroke","lightgray"),e.removeAttribute("id")}b.appendChild(c)}}function addAnimation(){function a(){const b=getKakusu();animator=new Vivus("kanji",{type:"oneByOne",duration:b*50},function(){setTimeout(a,2e3)})}a(),document.getElementById("kanji").addEventListener("click",function(){kanji.dataset.active=="false"?(animator.play(),kanji.dataset.active="true"):(animator.stop(),kanji.dataset.active="false")})}function init(){kanjiSvg=kanji.contentDocument.getElementsByTagName("svg")[0],addHitujun(),addAnimation()}document.getElementById("kanji").onload=init,document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("next").onclick=next,document.getElementById("play").onclick=play,document.getElementById("stop").onclick=stop,document.getElementById("prev").onclick=prev