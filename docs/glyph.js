function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function getUnicodeNameIndex(e){if(e<Number(13312))return void 0;if(e<=Number(19903))return["ExtA",e-Number(13312)];if(e<Number(19968))return void 0;if(e<=Number(25343))return["URO1",e-Number(19968)];if(e<=Number(30719))return["URO2",e-Number(25344)];if(e<=Number(36095))return["URO3",e-Number(30720)];if(e<=Number(40959))return["URO4",e-Number(36096)];if(e<Number(63744))return void 0;if(e<=Number(64217))return["CI",e-Number(63744)];if(e<=Number(136703))return["ExtB1",e-Number(131072)];if(e<=Number(143615))return["ExtB2",e-Number(136704)];if(e<=Number(148991))return["ExtB3",e-Number(143616)];if(e<=Number(155903))return["ExtB4",e-Number(148992)];if(e<=Number(161279))return["ExtB5",e-Number(155904)];if(e<=Number(168191))return["ExtB6",e-Number(161280)];if(e<=Number(173791))return["ExtB7",e-Number(168192)];if(e<Number(173824))return void 0;if(e<=Number(177977))return["ExtC",e-Number(173824)];if(e<Number(177984))return void 0;if(e<=Number(178205))return["ExtD",e-Number(177984)];if(e<Number(178208))return void 0;if(e<=Number(183969))return["ExtE",e-Number(178208)];if(e<Number(183984))return void 0;if(e<=Number(191456))return["ExtF",e-Number(183984)];if(e<Number(191472))return void 0;if(e<=Number(192093))return["ExtI",e-Number(191472)];if(e<Number(194560))return void 0;if(e<=Number(195101))return["CIS",e-Number(194560)];if(e<Number(196608))return void 0;if(e<=Number(201546))return["ExtG",e-Number(196608)];if(e<Number(201552))return void 0;if(e<=Number(205743))return["ExtH",e-Number(201552)]}async function fetchGlyphIndex(e){const t=await fetch(`/kanji-dict/glyph/${e}.svg.idx`),n=await t.arrayBuffer(),s=new Uint16Array(n);let o=0;return Array.from(s,e=>o+=e)}async function fetchGlyph(e,t){const n=await fetchGlyphIndex(e),s=n[t],o=n[t+1]-1,i=await fetch(`/kanji-dict/glyph/${e}.svg`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${s}-${o}`}});return await i.text()}async function fetchCSVIndex(e){const t=await fetch(`/kanji-dict/glyph/${e}.csv.idx`),n=await t.arrayBuffer(),s=new Uint16Array(n);let o=0;return Array.from(s,e=>o+=e)}async function fetchCSV(e,t){const n=await fetchCSVIndex(e),s=n[t],o=n[t+1]-1,i=await fetch(`/kanji-dict/glyph/${e}.csv`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${s}-${o}`}});return await i.text()}function getSvg(e){const s=(new DOMParser).parseFromString(e,"text/xml"),t=s.querySelector("glyph"),o=t.getAttribute("d"),i=t.getAttribute("horiz-adv-x"),n=t.getAttribute("vert-adv-y");return`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
  width="300" height="300" viewBox="0 0 ${i} ${n}">
  <g transform="scale(1, -1) translate(0, -${n})"><path d="${o}"></g>
</svg>
`}const dirNames=["小1","小2","小3","小4","小5","小6","中2","中3","高校","常用","準1級","1級"],unicodeNames=["表外","CJK統合漢字 (URO)","CJK互換漢字","CJK互換漢字補助","CJK統合漢字拡張A","CJK統合漢字拡張B","CJK統合漢字拡張C","CJK統合漢字拡張D","CJK統合漢字拡張E","CJK統合漢字拡張F","CJK統合漢字拡張G","CJK統合漢字拡張H","CJK統合漢字拡張I"],jisCodeNames=["表外","JIS第1水準","JIS第2水準","JIS第3水準","JIS第4水準"],jkatNames=["表外","10級 (小学1年生)","9級 (小学2年生)","8級 (小学3年生)","7級 (小学4年生)","6級 (小学5年生)","5級 (小学6年生)","4級 (中学1〜2年生)","3級 (中学3年生)","準2級 (高校性)","2級 (常用漢字)","準1級 (JIS第1水準)","1級 (JIS第2水準)"];function getExampleLinks(e){const t=new DocumentFragment;return e.split(" ").forEach(e=>{const n=document.createElement("a");n.href=`https://www.google.com/search?q=${e}とは`,n.textContent=e,n.className="px-1 text-nowrap",n.target="_blank",n.rel="noopener noreferer",t.appendChild(n)}),t}function getReferenceLink(e,t){const s=document.createElement("li"),n=document.createElement("a");return n.href=t,n.textContent=e,n.className="px-1 text-nowrap",n.target="_blank",n.rel="noopener noreferer",s.appendChild(n),s}function getLink(e,t){const n=document.createElement("a");return n.href=e,n.textContent=t,n}function getDictReferences(e){const t=new DocumentFragment,n=e.codePointAt(0).toString(16).toUpperCase();return t.appendChild(getReferenceLink("Wiktionary",`https://ja.wiktionary.org/wiki/${e}`)),t.appendChild(getReferenceLink("zi.tools",`https://zi.tools/zi/${e}`)),t.appendChild(getReferenceLink("漢語多功能字庫",`https://humanum.arts.cuhk.edu.hk//Lexis/lexi-mf/search.php?word=${e}`)),t.appendChild(getReferenceLink("國學大師",`https://www.guoxuedashi.net/zidian/${n}.html`)),t.appendChild(getReferenceLink("說文解字第一網",`http://www.shuowen.net/jiezi/${n}/`)),t}function getMeaningReferences(e){const t=new DocumentFragment;return t.appendChild(getReferenceLink("康熙字典網上版",`https://www.kangxizidian.com/kxhans/${e}`)),t.appendChild(getReferenceLink("中華語文知識庫",`https://www.chinese-linguipedia.org/search_results.html?query=${e}`)),t.appendChild(getReferenceLink("異體字詞典",`https://jf.xmu.edu.cn/variants/cc.html?q=${e}`)),t.appendChild(getReferenceLink("古今文字集成",`http://www.ccamc.co/cjkv.php?cjkv=${e}`)),t.appendChild(getReferenceLink("漢典",`https://www.zdic.net/hans/${e}`)),t}function getChineseGlyphReferences(e){const t=new DocumentFragment;return t.appendChild(getReferenceLink("Etymology",`https://hanziyuan.net/#${e}`)),t.appendChild(getReferenceLink("簡牘字典",`https://wcd-ihp.ascdc.sinica.edu.tw/woodslip/result.php?search=${e}`)),t.appendChild(getReferenceLink("歷史文字資料庫",`https://wcd-ihp.ascdc.sinica.edu.tw/union/?c=search&moji=${e}`)),t}function getJapanGlyphReferences(e){const t=new DocumentFragment,n=e.codePointAt(0).toString(16).toUpperCase();return t.appendChild(getReferenceLink("漢字字体規範史データセット",`https://search.hng-data.org/search/${e}`)),t.appendChild(getReferenceLink("篆書字体データセット",`http://codh.rois.ac.jp/tensho/unicode/U+${n}`)),t.appendChild(getReferenceLink("日本古典籍くずし字データセット",`http://codh.rois.ac.jp/char-shape/unicode/U+${n}`)),t.appendChild(getReferenceLink("史的文字データベース",`https://mojiportal.nabunken.go.jp/?c=search&moji=${e}`)),t.appendChild(getReferenceLink("拓本文字データベース",`http://coe21.zinbun.kyoto-u.ac.jp/djvuchar?query=${e}`)),t.appendChild(getReferenceLink("浄瑠璃丸本 字形データベース",`https://www.waseda.jp/prj-kyodo-enpaku/kuzushiji/DB/glyph/U+${n}.html`)),t.appendChild(getReferenceLink("国語研変体仮名字形データベース",`https://cid.ninjal.ac.jp/hentaiganaDB/DB/glyph/U+${n}.html`)),t}function getUnicodeReferences(e){const t=new DocumentFragment,n=e.codePointAt(0).toString(16).toUpperCase();return t.appendChild(getReferenceLink("Unihan Database",`http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=${n}`)),t.appendChild(getReferenceLink("CHISE",`https://www.chise.org/est/view/character/${e}`)),t.appendChild(getReferenceLink("GlyphWiki",`https://glyphwiki.org/wiki/u${n.toLowerCase()}`)),t.appendChild(getReferenceLink("文字情報基盤",`https://moji.or.jp/mojikibansearch/result?UCS=${n}`)),t}function addReferences(e){const n=document.getElementById("references"),t=n.querySelectorAll("ul");t[0].appendChild(getDictReferences(e)),t[1].appendChild(getMeaningReferences(e)),t[2].appendChild(getChineseGlyphReferences(e)),t[3].appendChild(getJapanGlyphReferences(e)),t[4].appendChild(getUnicodeReferences(e))}function addKanjiInfo(e,t){const n=t.split(","),o=Number(n[4]),r=document.querySelector("table"),s=r.querySelectorAll("tr");s[0].children[1].textContent=`${n[0]} (${n[1]})`,s[1].children[1].textContent=unicodeNames[Number(n[2])],s[2].children[1].textContent=jisCodeNames[Number(n[3])],s[3].children[1].textContent=jkatNames[o],s[4].children[1].textContent=n[5].replace(/ /g,","),s[5].children[1].textContent=n[6].replace(/ /g,",");const i=Number(n[7]);if(i!=0){const e=`${i}画`,t=i<25?e:"25画〜",n=`/kanji-dict/画数/${t}/`;s[6].children[1].appendChild(getLink(n,e))}const c=`/kanji-dict/部首/${n[8]}/`;s[7].children[1].appendChild(getLink(c,n[8])),s[8].children[1].textContent=n[9];const l=document.getElementById("examples"),a=l.querySelectorAll("div");if(a[0].appendChild(getExampleLinks(n[10])),a[1].appendChild(getExampleLinks(n[11])),a[2].appendChild(getExampleLinks(n[12])),o!=0){const n=`/kanji-dict/${dirNames[o-1]}/${e}/`,t=document.getElementById("kids");t.classList.remove("d-none"),t.href=n}}async function loadGlyph(){const o=new URLSearchParams(location.search),e=o.get("q"),n=e.match(/^[uU] ?/),t=n?parseInt("0x"+e.slice(n[0].length)):e.codePointAt(0),s=getUnicodeNameIndex(t);if(s){const e=String.fromCodePoint(t),i=t.toString(16).toUpperCase();document.title=`${e} (U+${i}) | ${document.title}`;const[n,o]=s,a=await fetchGlyph(n,o),r=getSvg(a);document.getElementById("kanji").innerHTML=r;const c=await fetchCSV(n,o);addKanjiInfo(e,c),addReferences(e)}else{const e=document.createElement("span");e.textContent="�",e.style.fontSize="300px",e.style.lineHeight=1,document.getElementById("kanji").appendChild(e)}}loadConfig(),loadGlyph(),document.getElementById("toggleDarkMode").onclick=toggleDarkMode