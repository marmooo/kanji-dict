function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}const ranges={ExtA:[13312,19903],URO1:[19968,25343],URO2:[25344,30719],URO3:[30720,36095],URO4:[36096,40959],CI:[63744,64217],ExtB1:[131072,136703],ExtB2:[136704,143615],ExtB3:[143616,148991],ExtB4:[148992,155903],ExtB5:[155904,161279],ExtB6:[161280,168191],ExtB7:[168192,173791],ExtC:[173824,177977],ExtD:[177984,178205],ExtE:[178208,183969],ExtF:[183984,191456],ExtI:[191472,192093],CIS:[194560,195101],ExtG:[196608,201546],ExtH:[201552,205743],ExtJ:[205744,210041]};function getUnicodeNameIndex(e){for(const[n,[t,s]]of Object.entries(ranges))if(e>=t&&e<=s)return[n,e-t]}async function fetchGlyphIndex(e){const t=await fetch(`/kanji-dict/glyph/${e}.svg.idx`),n=await t.arrayBuffer(),s=new Uint16Array(n);let o=0;return Array.from(s,e=>o+=e)}async function fetchGlyph(e,t){const n=await fetchGlyphIndex(e),s=n[t],o=n[t+1]-1,i=await fetch(`/kanji-dict/glyph/${e}.svg`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${s}-${o}`}});return await i.text()}async function fetchTSVIndex(e){const t=await fetch(`/kanji-dict/glyph/${e}.tsv.idx`),n=await t.arrayBuffer(),s=new Uint16Array(n);let o=0;return Array.from(s,e=>o+=e)}async function fetchTSV(e,t){const n=await fetchTSVIndex(e),s=n[t],o=n[t+1]-1,i=await fetch(`/kanji-dict/glyph/${e}.tsv`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${s}-${o}`}});return await i.text()}function getSVG(e){const s=(new DOMParser).parseFromString(e,"text/xml"),t=s.querySelector("glyph"),o=t.getAttribute("d"),i=t.getAttribute("horiz-adv-x"),n=t.getAttribute("vert-adv-y");return`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
  width="1em" height="1em" viewBox="0 0 ${i} ${n}">
  <g transform="scale(1, -1) translate(0, -${n})"><path d="${o}"></g>
</svg>
`}const dirNames=["小1","小2","小3","小4","小5","小6","中2","中3","高校","常用","準1級","1級"],unicodeNames=["表外","CJK統合漢字 (URO)","CJK互換漢字","CJK互換漢字補助","CJK統合漢字拡張A","CJK統合漢字拡張B","CJK統合漢字拡張C","CJK統合漢字拡張D","CJK統合漢字拡張E","CJK統合漢字拡張F","CJK統合漢字拡張G","CJK統合漢字拡張H","CJK統合漢字拡張I","CJK統合漢字拡張J"],jisCodeNames=["表外","JIS第1水準","JIS第2水準","JIS第3水準","JIS第4水準"],jkatNames=["表外","10級 (小学1年生)","9級 (小学2年生)","8級 (小学3年生)","7級 (小学4年生)","6級 (小学5年生)","5級 (小学6年生)","4級 (中学1〜2年生)","3級 (中学3年生)","準2級 (高校性)","2級 (常用漢字)","準1級 (JIS第1水準)","1級 (JIS第2水準)"];function getExampleLinks(e){const t=new DocumentFragment;return e.split(" ").forEach(e=>{const n=document.createElement("a");n.href=`https://www.google.com/search?q=${e}とは`,n.textContent=e,n.className="px-1 text-nowrap",n.target="_blank",n.rel="noopener noreferer",t.appendChild(n)}),t}function getReferenceLink(e,t){const s=document.createElement("li"),n=document.createElement("a");return n.href=t,n.textContent=e,n.className="px-1 text-nowrap",n.target="_blank",n.rel="noopener noreferer",s.appendChild(n),s}function getDictReferences(e){const t=new DocumentFragment,n=e.codePointAt(0).toString(16).toUpperCase();return t.appendChild(getReferenceLink("Wiktionary",`https://ja.wiktionary.org/wiki/${e}`)),t.appendChild(getReferenceLink("zi.tools",`https://zi.tools/zi/${e}`)),t.appendChild(getReferenceLink("漢語多功能字庫",`https://humanum.arts.cuhk.edu.hk//Lexis/lexi-mf/search.php?word=${e}`)),t.appendChild(getReferenceLink("國學大師",`https://www.guoxuedashi.net/zidian/${n}.html`)),t.appendChild(getReferenceLink("說文解字第一網",`http://www.shuowen.net/jiezi/${n}/`)),t}function getMeaningReferences(e){const t=new DocumentFragment;return t.appendChild(getReferenceLink("康熙字典網上版",`https://www.kangxizidian.com/kxhans/${e}`)),t.appendChild(getReferenceLink("中華語文知識庫",`https://www.chinese-linguipedia.org/search_results.html?query=${e}`)),t.appendChild(getReferenceLink("異體字詞典",`https://jf.xmu.edu.cn/variants/cc.html?q=${e}`)),t.appendChild(getReferenceLink("古今文字集成",`http://www.ccamc.co/cjkv.php?cjkv=${e}`)),t.appendChild(getReferenceLink("漢典",`https://www.zdic.net/hans/${e}`)),t}function getChineseGlyphReferences(e){const t=new DocumentFragment;return t.appendChild(getReferenceLink("Etymology",`https://hanziyuan.net/#${e}`)),t.appendChild(getReferenceLink("簡牘字典",`https://wcd-ihp.ascdc.sinica.edu.tw/woodslip/result.php?search=${e}`)),t.appendChild(getReferenceLink("歷史文字資料庫",`https://wcd-ihp.ascdc.sinica.edu.tw/union/?c=search&moji=${e}`)),t}function getJapanGlyphReferences(e){const t=new DocumentFragment,n=e.codePointAt(0).toString(16).toUpperCase();return t.appendChild(getReferenceLink("漢字字体規範史データセット",`https://search.hng-data.org/search/${e}`)),t.appendChild(getReferenceLink("篆書字体データセット",`http://codh.rois.ac.jp/tensho/unicode/U+${n}`)),t.appendChild(getReferenceLink("日本古典籍くずし字データセット",`http://codh.rois.ac.jp/char-shape/unicode/U+${n}`)),t.appendChild(getReferenceLink("史的文字データベース",`https://mojiportal.nabunken.go.jp/?c=search&moji=${e}`)),t.appendChild(getReferenceLink("拓本文字データベース",`http://coe21.zinbun.kyoto-u.ac.jp/djvuchar?query=${e}`)),t.appendChild(getReferenceLink("浄瑠璃丸本字形データベース",`https://prj-kyodo-enpaku.w.waseda.jp/kuzushiji/DB/glyph/U+${n}.html`)),t.appendChild(getReferenceLink("国語研変体仮名字形データベース",`https://cid.ninjal.ac.jp/hentaiganaDB/DB/glyph/U+${n}.html`)),t}function getUnicodeReferences(e){const t=new DocumentFragment,n=e.codePointAt(0).toString(16).toUpperCase();return t.appendChild(getReferenceLink("Unihan Database",`http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=${n}`)),t.appendChild(getReferenceLink("CHISE",`https://www.chise.org/est/view/character/${e}`)),t.appendChild(getReferenceLink("GlyphWiki",`https://glyphwiki.org/wiki/u${n.toLowerCase()}`)),t.appendChild(getReferenceLink("文字情報基盤",`https://moji.or.jp/mojikibansearch/result?UCS=${n}`)),t}function addReferences(e){const n=document.getElementById("references"),t=n.querySelectorAll("ul");t[0].appendChild(getDictReferences(e)),t[1].appendChild(getMeaningReferences(e)),t[2].appendChild(getChineseGlyphReferences(e)),t[3].appendChild(getJapanGlyphReferences(e)),t[4].appendChild(getUnicodeReferences(e))}function getStrokesComponent(e){const t=e.split(" ").map(e=>{const t=Number(e),n=t!=0?`${t}画`:"",s=t>=25?`25画〜`:`${t}画`;return`<a href="/kanji-dict/画数/${s}/">${n}</a>`});return t.join(" または ")}function getRadicalComponent(e){const t=Array.from("一丨丶丿乙亅二亠人儿入八冂冖冫几凵刀力勹匕匚匸十卜卩厂厶又口囗土士夂夊夕大女子宀寸小尢尸屮山巛工己巾干幺广廴廾弋弓彐彡彳心戈戶手支攴文斗斤方无日曰月木欠止歹殳毋比毛氏气水火爪父爻爿片牙牛犬玄玉瓜瓦甘生用田疋疒癶白皮皿目矛矢石示禸禾穴立竹米糸缶网羊羽老而耒耳聿肉臣自至臼舌舛舟艮色艸虍虫血行衣襾見角言谷豆豕豸貝赤走足身車辛辰辵邑酉釆里金長門阜隶隹雨靑非面革韋韭音頁風飛食首香馬骨高髟鬥鬯鬲鬼魚鳥鹵鹿麥麻黃黍黑黹黽鼎鼓鼠鼻齊齒龍龜龠"),n=e.split(" ").map(e=>{const s=Number(e),n=`${t[s]}部`;return`<a href="/kanji-dict/部首/${n}/">${n}</a>`});return n.join(" または ")}function getIDSComponent(e){let t="";return e.length===0?"":(e.split(" ").forEach(e=>{t+="<li>",t+=Array.from(e).map(e=>`<span>${e}</span>`).join(" ＋ "),t+="</li>"}),t)}async function getKanjiComponent(e){if(e==="")return"";let n="";const t=Array.from(e),s=new Array(t.length);for(let e=0;e<t.length;e++){const n=t[e];s[e]=loadGlyph(n.codePointAt(0))}const o=await Promise.all(s);for(let e=0;e<o.length;e++)n+=`<a class="p-1" href="/kanji-dict/glyph/?q=${t[e]}">${o[e]}</a>`;return n}async function addKanjiInfo(e,t,n){const s=n.split("	"),i=Number(s[4]),c=document.querySelector("table"),o=c.querySelectorAll("tr");o[0].children[1].textContent=`${s[0]} (${s[1]})`,o[1].children[1].textContent=unicodeNames[Number(s[2])],o[2].children[1].textContent=jisCodeNames[Number(s[3])],o[3].children[1].textContent=jkatNames[i],o[4].children[1].textContent=s[5].replace(/ /g,","),o[5].children[1].textContent=s[6].replace(/ /g,","),o[6].children[1].innerHTML=getStrokesComponent(s[7]),o[7].children[1].innerHTML=getRadicalComponent(s[8]),o[8].children[1].textContent=s[9],document.getElementById("ids").innerHTML=getIDSComponent(s[10]),document.getElementById("variants").innerHTML=await getKanjiComponent(s[11]);const l=document.getElementById("unihan"),r=l.querySelectorAll("td:nth-of-type(2)");for(let e=0;e<=6;e++)r[e].innerHTML=await getKanjiComponent(s[e+12]);for(let e=7;e<=17;e++)r[e].textContent=s[e+12];const d=document.getElementById("examples"),a=d.querySelectorAll("div");if(a[0].appendChild(getExampleLinks(s[30])),a[1].appendChild(getExampleLinks(s[31])),a[2].appendChild(getExampleLinks(s[32])),i!=0){const n=`/kanji-dict/${dirNames[i-1]}/${e}/`,t=document.getElementById("kids");t.classList.remove("d-none"),t.href=n}const u=`漢字「${e}」(U+${t}) の読み方・画数・部首・用例・成り立ちをまとめたページです。`;['meta[name="description"]','meta[property="og:description"]'].forEach(e=>{document.querySelector(e).setAttribute("content",u)})}async function loadSVG(e){const t=getUnicodeNameIndex(e);if(t){const[e,n]=t,s=await fetchGlyph(e,n);return getSVG(s)}}async function loadGlyph(e){const t=await loadSVG(e);return t||`<span>�</span>`}async function loadMainGlyph(e){const t=await loadGlyph(e);document.getElementById("kanji").innerHTML=t}loadConfig();const params=new URLSearchParams(location.search),q=params.get("q"),matchCode=q.match(/^[uU] ?/),code=matchCode?parseInt("0x"+q.slice(matchCode[0].length)):q.codePointAt(0);loadMainGlyph(code);const nameIndex=getUnicodeNameIndex(code);if(nameIndex){const e=String.fromCodePoint(code),t=code.toString(16).toUpperCase();document.title=`${e} (U+${t}) | ${document.title}`;const[n,s]=nameIndex,o=await fetchTSV(n,s);await addKanjiInfo(e,t,o),addReferences(e)}else document.title=`� (U+FFFD) | ${document.title}`;document.getElementById("toggleDarkMode").onclick=toggleDarkMode