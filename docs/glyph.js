function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function getUnicodeNameIndex(e){if(e<Number(13312))return void 0;if(e<=Number(19903))return["ExtA",e-Number(13312)];if(e<Number(19968))return void 0;if(e<=Number(25343))return["URO1",e-Number(19968)];if(e<=Number(30719))return["URO2",e-Number(25344)];if(e<=Number(36095))return["URO3",e-Number(30720)];if(e<=Number(40959))return["URO4",e-Number(36096)];if(e<Number(63744))return void 0;if(e<=Number(64217))return["CI",e-Number(63744)];if(e<=Number(136703))return["ExtB1",e-Number(131072)];if(e<=Number(143615))return["ExtB2",e-Number(136704)];if(e<=Number(148991))return["ExtB3",e-Number(143616)];if(e<=Number(155903))return["ExtB4",e-Number(148992)];if(e<=Number(161279))return["ExtB5",e-Number(155904)];if(e<=Number(168191))return["ExtB6",e-Number(161280)];if(e<=Number(173791))return["ExtB7",e-Number(168192)];if(e<Number(173824))return void 0;if(e<=Number(177977))return["ExtC",e-Number(173824)];if(e<Number(177984))return void 0;if(e<=Number(178205))return["ExtD",e-Number(177984)];if(e<Number(178208))return void 0;if(e<=Number(183969))return["ExtE",e-Number(178208)];if(e<Number(183984))return void 0;if(e<=Number(191456))return["ExtF",e-Number(183984)];if(e<Number(191472))return void 0;if(e<=Number(192093))return["ExtI",e-Number(191472)];if(e<Number(194560))return void 0;if(e<=Number(64029))return["CIS",e-Number(194560)];if(e<Number(196608))return void 0;if(e<=Number(201546))return["ExtG",e-Number(196608)];if(e<Number(201552))return void 0;if(e<=Number(205743))return["ExtH",e-Number(201552)]}async function fetchGlyphIndex(e){const t=await fetch(`/kanji-dict/glyph/${e}.svg.idx`),n=await t.arrayBuffer(),s=new Uint16Array(n);let o=0;return Array.from(s,e=>o+=e)}async function fetchGlyph(e,t){const n=await fetchGlyphIndex(e),s=n[t],o=n[t+1]-1,i=await fetch(`/kanji-dict/glyph/${e}.svg`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${s}-${o}`}});return await i.text()}async function fetchCSVIndex(e){const t=await fetch(`/kanji-dict/glyph/${e}.csv.idx`),n=await t.arrayBuffer(),s=new Uint16Array(n);let o=0;return Array.from(s,e=>o+=e)}async function fetchCSV(e,t){const n=await fetchCSVIndex(e),s=n[t],o=n[t+1]-1,i=await fetch(`/kanji-dict/glyph/${e}.csv`,{headers:{"content-type":"multipart/byteranges",range:`bytes=${s}-${o}`}});return await i.text()}function getSvg(e){const n=(new DOMParser).parseFromString(e,"text/xml"),t=n.querySelector("glyph"),s=t.getAttribute("d"),o=t.getAttribute("horiz-adv-x"),i=t.getAttribute("vert-adv-y");return`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
  width="300" height="300" viewBox="0 0 ${o} ${i}"
  transform="scale(1, -1)">
  <path d="${s}">
</svg>
`}unicodeNames=["表外","CJK統合漢字 (URO)","CJK互換漢字","CJK互換漢字補助","CJK統合漢字拡張A","CJK統合漢字拡張B","CJK統合漢字拡張C","CJK統合漢字拡張D","CJK統合漢字拡張E","CJK統合漢字拡張F","CJK統合漢字拡張G","CJK統合漢字拡張H","CJK統合漢字拡張I"],jisCodeNames=["表外","JIS第1水準","JIS第2水準","JIS第3水準","JIS第4水準"],jkatNames=["表外","10級 (小学1年生)","9級 (小学2年生)","8級 (小学3年生)","7級 (小学4年生)","6級 (小学5年生)","5級 (小学6年生)","4級 (中学1〜2年生)","3級 (中学3年生)","準2級 (高校性)","2級 (常用漢字)","準1級 (JIS第1水準)","1級 (JIS第2水準)"];function getExampleLinks(e){const t=new DocumentFragment;return e.split(" ").forEach(e=>{const n=document.createElement("a");n.href=`https://www.google.com/search?q=${e}とは`,n.textContent=e,n.className="px-1 text-nowrap",n.target="_blank",n.rel="noopener noreferer",t.appendChild(n)}),t}function getLink(e,t){const n=document.createElement("a");return n.href=e,n.textContent=t,n}function addKanjiInfo(e,t){const n=t.split(","),i=document.querySelector("table"),s=i.querySelectorAll("tr");if(s[0].children[1].textContent=`U+${e.toString(16).toUpperCase()}`,s[1].children[1].textContent=unicodeNames[Number(n[1])],s[2].children[1].textContent=jisCodeNames[Number(n[2])],s[3].children[1].textContent=jkatNames[Number(n[3])],s[4].children[1].textContent=n[4].replace(/ /g,","),s[5].children[1].textContent=n[5].replace(/ /g,","),n[6]!="0"){const e=`${n[6]}画`,t=`/kanji-dict/画数/${e}/`;s[6].children[1].appendChild(getLink(t,e))}const a=`/kanji-dict/部首/${n[7]}/`;s[7].children[1].appendChild(getLink(a,n[7])),s[8].children[1].textContent=n[8];const r=document.getElementById("examples"),o=r.querySelectorAll("div");o[0].appendChild(getExampleLinks(n[9])),o[1].appendChild(getExampleLinks(n[10])),o[2].appendChild(getExampleLinks(n[11]))}async function loadGlyph(){const o=new URLSearchParams(location.search),t=o.get("q"),n=t.match(/^[uU] ?/),e=n?parseInt("0x"+t.slice(n[0].length)):t.codePointAt(0),s=getUnicodeNameIndex(e);if(s){const o=String.fromCodePoint(e),i=e.toString(16).toUpperCase();document.title=`${o} (U+${i}) | ${document.title}`;const[t,n]=s,a=await fetchGlyph(t,n),r=getSvg(a);document.getElementById("kanji").innerHTML=r;const c=await fetchCSV(t,n);addKanjiInfo(e,c)}else{const e=document.createElement("span");e.textContent="�",e.style.fontSize="300px",e.style.lineHeight=1,document.getElementById("kanji").appendChild(e)}}loadConfig(),loadGlyph(),document.getElementById("toggleDarkMode").onclick=toggleDarkMode